# BOSHDeployment

- [BOSHDeployment](#bosheployment)
  - [Reconcilers](#reconcilers)
    - [Deployment Reconciler](#deployment-reconciler)
    - [Generated Variable Reconciler](#generated-variable-reconciler)
    - [BPM Reconciler](#bpm-reconciler)

## Reconcilers

### Deployment Reconciler

Watches for:

- `BOSHDeployment`
- `ConfigMap`/`Secret` for ops files
- `ConfigMap`/`Secret` from deployment manifest

Creates/updates:

- the var interpolation extended job
- the data gathering extended job

> **Note:** the output of the "Var Interpolation" `ExtendedJob` is the input for the "Data Gathering" `ExtendedJob`.
> The "Data Gathering" step generates 2 secrets for each Instance Group:
>
> - Instance Group Resolved Properties
> - Instance Group BPM
>
> The "Versioned" `Secret` for Instance Group Resolved Properties is referenced by the Instance Group `ExtendedStatefulSets` and `ExtendedJobs`

### Generated Variable Reconciler

Watches for:

- the "with-ops secret" (e.g. `nats-deployment.with-ops`)

Creates/updates:

- `ExtendedSecret` for each explicit variable from the manifest

> **Note:** the `Secrets` generated by these `ExtendedSecrets` are referenced by the "Var Interpolation" `ExtendedJob`.
> When these get created/updated, the "Var Interpolation" job is run.

### BPM Reconciler

Watches for:

- the "Versioned" `Secret` for Instance Group BPM

Creates/updates:

- actual BOSH Instance Group `ExtendedStatefulSets` and `ExtendedJobs`
